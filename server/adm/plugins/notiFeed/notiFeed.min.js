!function(e){e.extend({notiFeed:{feedList:{},defaults:{title:"Notifications",linkText:"Read more",emptyListText:"No new notifications",notiFeedID:"notiFeed",container:void 0,counterObj:void 0,containerClass:"dropdown-menu",titleClass:"noti-feed-title",titleDelete:"Delete notification",emptyListClass:"noti-feed-empty-list-title",descClass:"noti-feed-desc",ajax_link:"",set_readed_link:"",set_remind_link:"",set_deleted_link:"",checkTimeOut:6e5,timer:void 0,openFeedItemCallback:function(){}},setSettings:function(t){this.defaults=e.extend(this.defaults,t)},init:function(e){return this.setSettings(e||{}),this},create:function(){return this.container=this.createContainer(),this.setAutoCheck(),this.container},createContainer:function(){var t=e("<ul></ul>");return t.addClass(this.defaults.containerClass).attr("id",this.defaults.notiFeedID),t},createFeedListTitle:function(){this.dropCounter();var t=e("<li></li>"),i=e("<div class='row'></div>").appendTo(t);i=e("<div class='col-xs-12'></div>").appendTo(i),(i=e(Object.keys(this.feedList).length?this.defaults.title:this.defaults.emptyListText).appendTo(i)).addClass(Object.keys(this.feedList).length?this.defaults.titleClass:this.defaults.emptyListClass),this.container.children(":first").remove(),this.container.prepend(t)},fillFeedList:function(){var e;for(var t in this.container.empty(),this.createFeedListTitle(),this.feedList)this.feedList[t].itemObj||(e=this.feedItemCreate(t),this.feedList[t].itemObj=e,this.container.append(e));this.setCounter()},updateFeedList:function(t){!t&&this.defaults.ajax_link&&e.ajax({async:!1,dataType:"json",method:"POST",url:this.defaults.ajax_link,success:function(e){t=e.data}});t=t||{};for(var i in t)this.feedList[t[i].guid]=t[i];this.fillFeedList()},setReadedItem:function(t,i){if(t&&this.feedList[t]){var s=this;i=void 0!==i&&i;e.ajax({async:!1,dataType:"json",method:"POST",url:this.defaults.set_readed_link,data:{feed_item_id:t},success:function(a){i&&(s.feedList[t].itemObj.slideUp("fast",function(){e(this).remove()}),delete s.feedList[t],s.createFeedListTitle())}})}},setReadedAll:function(){e.ajax({async:!1,dataType:"json",method:"POST",url:this.defaults.set_readed_link})},setDeletedItem:function(t){if(t&&this.feedList[t]){var i=this;e.ajax({async:!1,dataType:"json",method:"POST",url:this.defaults.set_deleted_link,data:{guid:t},success:function(s){i.feedList[t].itemObj.slideUp("fast",function(){e(this).remove()}),delete i.feedList[t],i.createFeedListTitle()}})}},setCounter:function(){var e=0;for(var t in this.feedList)0==parseInt(this.feedList[t].read,10)&&e++;this.defaults.counterObj&&(this.defaults.counterObj.text(e),e>0&&!this.defaults.counterObj.hasClass("red")?this.defaults.counterObj.addClass("red").removeClass("invisible"):0==e&&(this.defaults.counterObj.removeClass("red").addClass("invisible"),this.defaults.counterObj.hasClass("invisible")||this.defaults.counterObj.addClass("invisible")))},dropCounter:function(){if(this.defaults.counterObj){this.defaults.counterObj.text(0),this.defaults.counterObj.removeClass("red").addClass("invisible")}},setAutoCheck:function(){if(this.defaults.checkTimeOut&&!this.defaults.timer){var e=this;this.defaults.timer=setInterval(function(){e.updateFeedList()},this.defaults.checkTimeOut)}},feedItemCreate:function(t){var i=this.feedList[t],s=e("<li></li>"),a=e("<div class='row'></div>").appendTo(s),n=new Date(Date.parse(i.pub_date));a=e("<div class='col-xs-12'></div>").appendTo(a),a=e('<div class="box"></div>').appendTo(a),(a=e("<div class='box-content'></div>").appendTo(a)).addClass("category-icon "+i.category),(a=e("<div class='col-xs-11 col-xs-offset-1'></div>").appendTo(a)).append('<a class="close-link" title="'+this.defaults.titleDelete+'"><i class="fa fa-times"></i></a>').append("<label>"+i.title+"</label>");var d=e("<div></div>").appendTo(a);if(d.append('<div class="'+this.defaults.descClass+'">'+i.description+"</div>"),d.append('<span class="pull-right">'+n.toLocaleFormat("%b %d, %Y")+"</span>"),i.link){var l=this,o=e('<a href="'+i.link+'" target="_blank">'+this.defaults.linkText+"</a>");d.append(o),o.click(function(e){e.stopPropagation(),l.setReadedItem(t,!1)})}return s.data("feedItemId",i.guid),s}}}),e.fn.extend({notiFeed:function(t){var i=this;!t.ajax_link&&this.last("a")&&(t.ajax_link=this.children("a:last").attr("href")),t.set_readed_link||(t.set_readed_link=t.ajax_link+"-set-readed"),t.set_remind_link||(t.set_remind_link=t.ajax_link+"-set-remind"),t.set_deleted_link||(t.set_deleted_link=t.ajax_link+"-mark-deleted"),t.counterObj||(t.counterObj=this.find("a:last > span"));var s=e.notiFeed.init(t);return this.append(s.create()),s.container.prev().addClass("dropdown-toggle").attr("data-toggle","dropdown"),e(this).on("click",function(t){e(this).hasClass("open")||s.updateFeedList()}),e(document).on("click",function(t){e(i).removeClass("open")}),e(s.container).on("click","li a.close-link",function(t){t.preventDefault(),t.stopPropagation(),s.setDeletedItem(e(this).closest("li").data("feedItemId"))}),e(s.container).on("click","li",function(t){t.preventDefault(),t.stopPropagation(),s.defaults.openFeedItemCallback(e(this).data("feedItemId"))}),s}})}(jQuery);